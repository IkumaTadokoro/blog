---
import { render } from "astro:content";
import { getTalk, getTalks } from "../../entities/talk/api";
import { TalkID } from "../../entities/talk/model/schema";
import Talk from "../../features/talk/ui/talk.astro";
import Document from "../../widgets/layout/document/index.astro";

export async function getStaticPaths() {
  const talksEntries = await getTalks();
  return talksEntries.map((entry) => {
    return {
      params: { id: TalkID(entry) },
      props: { entry },
    };
  });
}

const { entry: originalEntry } = Astro.props;
const { slideIframeString, entry } = await getTalk(originalEntry);
const { Content } = await render(entry);
---

<Document title={`${entry.data.title!}`}>
  <Talk title={entry.data.title!} publishDate={entry.data.pubdate!}>
    <Fragment set:html={slideIframeString} slot="slide" />
    <Content slot="content" />
  </Talk>
</Document>
